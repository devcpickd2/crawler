<div class="container container-dope-black">
    <div class="container-fluid px-2 px-md-4">
        <div class="page-header min-height-300 border-radius-xl mt-4"
            style="background-image: url('<?= base_url() ?>assets/img/image3.jpg');">

        </div>
        <div class="card card-body mx-3 mx-md-4 mt-n6">
            <div class="row gx-4 mb-2">
                <div class="col-auto">
                    <div class="avatar avatar-xl position-relative">
                        <img src="<?= base_url() ?>assets/img/cpi-logo.png" alt="profile_image"
                            class="w-100 border-radius-lg shadow-sm">
                    </div>
                </div>
                <div class="col-auto my-auto">
                    <div class="h-100">
                        <h5 class="mb-1">
                            PT CHAROEN POKPHAND VS COMPETITOR
                        </h5>
                        <p class="mb-0 font-weight-normal text-sm">
                            Chart / Analysis Comparison
                        </p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="container mt-4">
                        <!-- Heading for clarity -->
                        <div class="text-center mb-2">
                            <h5>Select Products for Comparison</h5>
                        </div>

                        <!-- Dropdown buttons and Compare button in a row -->
                        <div class="d-flex justify-content-center gap-3">
                            <div class="dropdown">
                                <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Select PT Charoen Pokphand Product
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Ready Meal">Fiesta Ready
                                            Meal</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Ready To Go">Fiesta Ready
                                            To Go</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Chicken Nugget">Fiesta
                                            Chicken Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Crispy Bubble">Fiesta
                                            Crispy Bubble</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Chicken Sausage">Fiesta
                                            Chicken Sausage</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Tepung Roti">Fiesta
                                            Tepung Roti</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Tepung Bumbu">Fiesta
                                            Tepung Bumbu</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Bumbu Racik">Fiesta
                                            Bumbu Racik</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Ready To Eat">Fiesta
                                            Ready To Eat</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Ready To Serve">Fiesta
                                            Ready To Serve</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Champ Chicken Nugget">Champ
                                            Chicken Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Champ Sosis">Champ
                                            Sosis</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Okey Nugget Ayam">Okey
                                            Nugget Ayam</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Okey Sosis">Okey
                                            Sosis</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Asimo Nugget">Asimo
                                            Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Asimo Sosis">Asimo
                                            Sosis</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Akumo Nugget">Akumo
                                            Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Pizza">Fiesta
                                            Pizza</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Fiesta Ramen">Fiesta
                                            Ramen</a></li>
                                </ul>
                            </div>

                            <div class="dropdown">
                                <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton2"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Select Competitor Product
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                                    <li><a class="dropdown-item" href="#" data-product="Kanzler Nugget">Kanzler
                                            Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Kanzler Sosis">Kanzler Sosis</a>
                                    </li>
                                    <li><a class="dropdown-item" href="#" data-product="Kanzler Cordon Bleu">Kanzler
                                            Cordon Bleu</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Kanzler Singles">Kanzler
                                            Singles</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Kimbo Sosis">Kimbo
                                            Sosis</a></li>
                                    <li><a class="dropdown-item" href="#"
                                            data-product="So Good Crispy Chicken Nugget">So
                                            Good Crispy Chicken Nugget</a>
                                    </li>
                                    <li><a class="dropdown-item" href="#" data-product="So Nice Sosis Premium">So
                                            Nice Sosis Premium</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="So Nice Sosis Siap Makan">So
                                            Nice Sosis Siap Makan</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Bellfoods">Bellfoods</a>
                                    </li>
                                    <li><a class="dropdown-item" href="#" data-product="Sunny Gold Nugget">Sunny
                                            Gold Nugget</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Salam Nugget Ayam">Salam
                                            Nugget Ayam</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Salam Sosis Ayam">Salam
                                            Sosis Ayam</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Sasa Tepung Bumbu">Sasa
                                            Tepung Bumbu</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Bumbu Racik Indofood">Bumbu
                                            Racik Indofood</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Sosis gaga">Sosis
                                            gaga</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Kobe Bumbu">Kobe
                                            Bumbu</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Kobe Tepung">Kobe
                                            Tepung</a></li>
                                    <li><a class="dropdown-item" href="#" data-product="Laukita">Laukita</a>
                                    </li>
                                </ul>
                            </div>
                            <button class="btn btn-success" id="compareButton">Compare</button>
                        </div>

                        <!-- Display selected products -->
                        <div class="text-center mt-2">
                            <p id="selectedProducts">No products selected yet.</p>
                        </div>

                        <!-- Chart positioned below the dropdowns -->
                        <div class="mt-4">
                            <canvas id="comparisonchart" width="400" height="200"></canvas>
                            <!-- Detailed Data Table -->
                            <!-- Detailed Data Table -->

                            <div class="table-responsive mt-4">
                                <table id="detailsTable" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Year</th>
                                            <th class="text-center">PT Pokphand Mentions</th>
                                            <th class="text-center">Competitor Mentions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Rows will be dynamically inserted here -->
                                    </tbody>
                                </table>
                               

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        let pokphandKeyword = '';
        let competitorKeyword = '';

        // Update selected products display
        function updateSelectedProductsDisplay() {
            const selectedText = `Selected: PT Pokphand - ${pokphandKeyword || 'Not Selected'} | Competitor - ${competitorKeyword || 'Not Selected'}`;
            $('#selectedProducts').text(selectedText);
        }

        // Chart configuration with two datasets
        const config = {
            type: 'bar',
            data: {
                labels: [], // Placeholder for dynamic years
                datasets: [
                    {
                        label: 'PT Pokphand', // Initial label, will be updated
                        data: [],
                        backgroundColor: 'rgba(54, 162, 235, 0.5)', // Blue for PT Pokphand
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                    },
                    {
                        label: 'Competitor', // Initial label, will be updated
                        data: [],
                        backgroundColor: 'rgba(255, 99, 132, 0.5)', // Red for Competitor
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                    }
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Mentions Comparison',
                    },
                    legend: {
                        display: true,
                    },
                },
                scales: {
                    y: {
                        beginAtZero: true,
                    },
                },
            },
        };

        const comparisonChart = new Chart(document.getElementById('comparisonchart'), config);

        // Function to fetch data for both products and update the chart and table
        function fetchComparisonData() {
            if (!pokphandKeyword || !competitorKeyword) {
                alert('Please select both products.');
                return;
            }

            $.ajax({
                url: '<?= base_url("home/get_mentions_per_year") ?>',
                method: 'POST',
                data: { keyword: pokphandKeyword },
                dataType: 'json',
                success: function (pokphandData) {
                    console.log("Pokphand Data:", pokphandData); // Debugging
                    $.ajax({
                        url: '<?= base_url("home/get_mentions_per_year") ?>',
                        method: 'POST',
                        data: { keyword: competitorKeyword },
                        dataType: 'json',
                        success: function (competitorData) {
                            console.log("Competitor Data:", competitorData); // Debugging
                            updateChart(pokphandData, competitorData); // Update the chart and table
                        },
                        error: function (error) {
                            console.error('Error fetching competitor data:', error);
                        },
                    });
                },
                error: function (error) {
                    console.error('Error fetching PT Pokphand data:', error);
                },
            });
        }

        // Function to update the chart and the details table
        function updateChart(pokphandData, competitorData) {
            const pokphandYears = pokphandData.map(item => item.year);
            const competitorYears = competitorData.map(item => item.year);

            // Merge and sort unique years from both datasets
            const allYears = Array.from(new Set([...pokphandYears, ...competitorYears])).sort();

            // Map data for each year for both datasets
            const pokphandMentions = allYears.map(year => {
                const entry = pokphandData.find(item => item.year === year);
                return entry ? entry.mentions : 0;
            });

            const competitorMentions = allYears.map(year => {
                const entry = competitorData.find(item => item.year === year);
                return entry ? entry.mentions : 0;
            });

            // Update chart labels and datasets
            comparisonChart.data.labels = allYears;
            comparisonChart.data.datasets[0].data = pokphandMentions;
            comparisonChart.data.datasets[1].data = competitorMentions;
            comparisonChart.update();

            // Call the function to update the table
            updateDetailsTable(allYears, pokphandMentions, competitorMentions);
        }

        // Function to update the details table
        function updateDetailsTable(years, pokphandMentions, competitorMentions) {
    const tableBody = $('#detailsTable tbody');
    tableBody.empty(); // Clear any previous rows

    // Loop through the data and insert rows
    years.forEach((year, index) => {
        const pokphandMention = pokphandMentions[index];
        const competitorMention = competitorMentions[index];

        // Append a new row to the table with 'text-center' class for centered alignment
        const newRow = `
            <tr>
                <td class="text-center">${year}</td>
                <td class="text-center">${pokphandMention}</td>
                <td class="text-center">${competitorMention}</td>
            </tr>
        `;
        tableBody.append(newRow);
    });
}


        // Handle product selection for PT Charoen Pokphand
        $('#dropdownMenuButton1').next('.dropdown-menu').find('.dropdown-item').click(function () {
            pokphandKeyword = $(this).data('product');
            updateSelectedProductsDisplay();
        });

        // Handle product selection for Competitor
        $('#dropdownMenuButton2').next('.dropdown-menu').find('.dropdown-item').click(function () {
            competitorKeyword = $(this).data('product');
            updateSelectedProductsDisplay();
        });

        // Handle compare button click
        $('#compareButton').click(fetchComparisonData);
    });
</script>


<link rel="apple-touch-icon" sizes="76x76" href="<?= base_url() ?>assets/img/apple-icon.png" />
<link rel="icon" type="image/png" href="<?= base_url() ?>assets/img/favicon.png" />
<link rel="stylesheet" type="text/css"
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
<link href="<?= base_url() ?>assets/css/nucleo-icons.css" rel="stylesheet" />
<link href="<?= base_url() ?>assets/css/nucleo-svg.css" rel="stylesheet" />
<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
<link id="pagestyle" href="<?= base_url() ?>assets/css/material-dashboard.css?v=3.1.0" rel="stylesheet" />
<script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>
<script src="<?= base_url() ?>assets/js/plugins/chartjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>